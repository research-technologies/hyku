<!-- rendered from  app/shared/ubiquity/contributor/new_form.html.erb -->
<!-- rendered from  app/shared/ubiquity/contributor/edit_form.html.erb -->


<% template = f.object.model.class.to_s.underscore %>
<% array_of_hash = get_model( f.object.contributor, template, 'contributor', 'contributor_position') %>
<% array_of_hash = array_of_hash ||  [{}] %>

<% required_toggle = check_for_nested_setting('html_required','contributor')%>
<% contributor_list = list_of_json_properties('contributor') %>
<% span_content = required_toggle.present? ? t('hyrax.control.required') : ' ' %>
<% span_content_css = required_toggle.present? ? 'label label-info required-tag' : ' ' %>

<% array_of_hash.each_with_index do |hash, index| %>
  <div class="ubiquity-meta-contributor" >
    <% if template == 'collection' %>
      <label class="control-label multi_value optional" for="#{template}_contributor_name_type">
        <%= t('hyrax.labels.contributor') %> </label>

      <%= select_tag "#{template}[contributor_group][][contributor_name_type]", content_tag(:option,'select one...',:value=>"")+options_from_collection_for_select( NameTypeService.new.select_active_options.flatten.uniq!, :to_s, :to_s, hash.dig("contributor_name_type")),
                      class: 'ubiquity_contributor_name_type', data: {field_name:'ubiquity_contributor_name_type'} %>

    <% else %>
      <label class="control-label multi_value optional" for="#{template}_contributor_name_type">
        <%= t('hyrax.labels.contributor') %> <span class="<%= span_content_css%>"><%= span_content %></span></label>

      <%= select_tag "#{template}[contributor_group][][contributor_name_type]", content_tag(:option,'select one...',:value=>"")+options_from_collection_for_select( NameTypeService.new.select_active_options.flatten.uniq!, :to_s, :to_s, hash.dig("contributor_name_type")),
                    required: required_toggle , class: 'ubiquity_contributor_name_type', data: {field_name:'ubiquity_contributor_name_type'} %>
    <% end %>

    <p class="help-block"> <%= t('hyrax.hints.contributor') %> </p>

    <% if contributor_list.include?('contributor_isni')%>
      <%= render 'shared/ubiquity/json_fields_partials/isni', template: template, metadata_field: "contributor", hash: hash %>
    <% end %>

    <span class="ubiquity_organization_fields">

    <label class="ubiquity_contributor_organization_name_label control-label multi_value optional" for="#{template}_contributor_organization_name">
      <%= t('hyrax.labels.contributor_org') %></label>

    <%= text_field_tag "#{template}[contributor_group][][contributor_organization_name]", hash.dig("contributor_organization_name"),
                        class: "#{template}_contributor_organization_name form-control multi-text-field multi_value ubiquity_contributor_organization_name",
                        placeholder: t('hyrax.placeholders.contributor_org'),
                        name: "#{template}[contributor_group][][contributor_organization_name]",
                        data: {field_name:'ubiquity_contributor_organization_name'}
    %>
    <span style="color:red;" class="error">  <%= t('hyrax.errors.required') %></span>

  </span>
  <br/>
    <span class="ubiquity_personal_fields">

      <% if contributor_list.include?('contributor_orcid')%>
        <%= render 'shared/ubiquity/json_fields_partials/orcid', template: template, metadata_field: "contributor", hash: hash %>
      <% end %>
      <br>

      <% if contributor_list.include?('contributor_family_name')%>
        <%= render 'shared/ubiquity/json_fields_partials/family_name', template: template, metadata_field: "contributor", hash: hash %>
      <% end %>

      <br>
      <% if contributor_list.include?('contributor_middle_name')%>
        <%= render 'shared/ubiquity/json_fields_partials/middle_name', template: template, metadata_field: "contributor", hash: hash %>
      <% end %>
      <br>

      <% if contributor_list.include?('contributor_given_name')%>
        <%= render 'shared/ubiquity/json_fields_partials/given_name', template: template, metadata_field: "contributor", hash: hash %>
      <% end %>
      <br/>

      <br>
      <% if contributor_list.include?('contributor_suffix')%>
        <%= render 'shared/ubiquity/json_fields_partials/suffix', template: template, metadata_field: "contributor", hash: hash %>
      <% end %>
      <br>

      <% if contributor_list.include?('contributor_institutional_relationship')%>
        <%= render 'shared/ubiquity/json_fields_partials/institutional_relationship', template: template, metadata_field: "contributor", hash: hash, f:f  %>
      <% end %>
      <br>

      <% if contributor_list.include?('contributor_role')%>
        <%= render 'shared/ubiquity/json_fields_partials/role', template: template, metadata_field: "contributor", hash: hash %>
      <% end %>

    </span> <!-- closes ubiquity_personal_fields -->

    <br>

    <%= hidden_field_tag "#{template}[contributor_group][][contributor_position]", index, class: 'ubiquity-contributor-score'  %>

    <a href="#" style="color:red;"  class=" remove_contributor form-group " data-removeUbiquitycontributor=".ubiquity-meta-contributor">
      <span class="glyphicon glyphicon-remove"></span>
      <span class="controls-remove-text"> <%= t('hyrax.control.remove') %> </span>
    </a>
    |
    <a href="#" class=" add_contributor" data-addUbiquitycontributor=".ubiquity-meta-contributor"><%= t('hyrax.control.add') %></a>

    <br><br><br>

  </div>
<% end %>
